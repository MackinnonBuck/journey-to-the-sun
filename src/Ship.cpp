#include "Ship.h"

#include <iostream>

#include "stb_image.h"

void Ship::init(const std::string& resourceDirectory)
{
	AnimatedActor::init(resourceDirectory);

	m_shape = std::make_shared<Shape>();

    m_albedoTexture = SmartTexture::createTexture(resourceDirectory + "Materials/PaintedMetal/albedo.jpg");
    m_roughnessTexture = SmartTexture::createTexture(resourceDirectory + "Materials/PaintedMetal/roughness.jpg");
    m_metallicTexture = SmartTexture::createTexture(resourceDirectory + "Materials/PaintedMetal/metallic.jpg");
    m_aoTexture = SmartTexture::createTexture(resourceDirectory + "Materials/PaintedMetal/ao.jpg");

	auto mtlDir = resourceDirectory + "/Ship/";
	m_shape->loadMesh(resourceDirectory + "/Ship/Ship.obj", &mtlDir, stbi_load);

	//m_shape->resize();
	m_shape->init();

    setBaseRotation(glm::rotate(glm::quat(1.0f, 0.0f, 0.0f, 0.0f), glm::pi<float>() * 0.5f, glm::vec3(1.0f, 0.0f, 0.0f)));

    addKeyframes();
}

void Ship::render(const glm::mat4& pMatrix, const glm::mat4& vMatrix, const glm::mat4& mMatrix)
{
	auto& editorState = getEditorState();

    //glm::vec3 lightPosition = glm::vec3(0.0f, 1000.0f, 0.0f);
    //glm::vec3 lightColor = glm::vec3(1.0f, 1.0f, 0.7f) * 500000.0f;

	m_shaderProgram->bind();

    //m_albedoTexture->bind(0, 1);
    //m_roughnessTexture->bind(0, 2);
    //m_metallicTexture->bind(0, 3);
    //m_aoTexture->bind(0, 4);
    
    // TODO: Better solution for skybox.
 //   glActiveTexture(GL_TEXTURE0);
	//glBindTexture(GL_TEXTURE_2D, m_skyboxTextureId);

    glm::vec3 cameraPosition = -editorState.cameraPosition;

	glUniformMatrix4fv(m_shaderProgram->getUniform("P"), 1, GL_FALSE, &pMatrix[0][0]);
	glUniformMatrix4fv(m_shaderProgram->getUniform("V"), 1, GL_FALSE, &vMatrix[0][0]);
	glUniformMatrix4fv(m_shaderProgram->getUniform("M"), 1, GL_FALSE, &mMatrix[0][0]);
    glUniform3fv(m_shaderProgram->getUniform("lightPositions"), LIGHT_COUNT, &editorState.lightPositions[0][0]);
    glUniform3fv(m_shaderProgram->getUniform("lightColors"), LIGHT_COUNT, &editorState.lightColors[0][0]);
	glUniform3fv(m_shaderProgram->getUniform("viewPos"), 1, &cameraPosition[0]);
    glUniform3f(m_shaderProgram->getUniform("albedo"), 2.0f, 2.0f, 2.0f);
    glUniform1f(m_shaderProgram->getUniform("roughness"), 0.05f);
    glUniform1f(m_shaderProgram->getUniform("metallic"), 1.0f);
    glUniform1f(m_shaderProgram->getUniform("ao"), 0.25f);
	m_shape->draw(m_shaderProgram);			//render!!!!!!!
	m_shaderProgram->unbind();

    m_albedoTexture->unbind();
    m_roughnessTexture->unbind();
    m_metallicTexture->unbind();
    m_aoTexture->unbind();
}

void Ship::addKeyframes()
{
	addPositionKeyframes(0, {
        Keyframe({992.0000, -0.3367}, {991.6667, -0.3367}, {992.3333, -0.3367}),
        Keyframe({993.0000, -0.3452}, {992.6667, -0.3396}, {1000.3333, -0.4672}),
        Keyframe({1015.0000, -1.8707}, {1007.6667, -1.8707}, {1025.3334, -1.8707}),
        Keyframe({1046.0000, 7.5252}, {1035.6666, 3.4534}, {1060.6666, 13.3046}),
        Keyframe({1090.0000, 16.5611}, {1075.3334, 16.5611}, {1105.3334, 16.5611}),
        Keyframe({1136.0000, -2.5452}, {1120.6666, -2.5452}, {1151.3334, -2.5452}),
        Keyframe({1182.0000, 6.6162}, {1166.6666, 6.6162}, {1199.0000, 6.6162}),
        Keyframe({1233.0000, 5.4573}, {1216.0000, 5.4573}, {1246.3334, 5.4573}),
        Keyframe({1273.0000, 23.4021}, {1259.6666, 22.8654}, {1288.3334, 24.0193}),
        Keyframe({1319.0000, 24.0193}, {1303.6666, 24.0193}, {1334.0000, 24.0193}),
        Keyframe({1364.0000, 20.3814}, {1349.0000, 20.3814}, {1379.3334, 20.3814}),
        Keyframe({1410.0000, 49.8882}, {1394.6666, 46.7988}, {1419.6666, 51.8359}),
        Keyframe({1439.0000, 51.8359}, {1429.3334, 50.4572}, {1451.6666, 53.6424}),
        Keyframe({1477.0000, 60.1834}, {1464.3334, 60.1834}, {1492.6666, 60.1834}),
        Keyframe({1524.0000, 48.0333}, {1508.3334, 48.0333}, {1536.3334, 48.0333}),
        Keyframe({1561.0000, 55.9021}, {1548.6666, 55.9021}, {1573.3334, 55.9021}),
        Keyframe({1598.0000, 51.4633}, {1585.6666, 51.4633}, {1613.0000, 51.4633}),
        Keyframe({1643.0000, 54.6138}, {1628.0000, 54.6138}, {1659.3334, 54.6138}),
        Keyframe({1692.0000, 48.9916}, {1675.6666, 48.9916}, {1705.3334, 48.9916}),
        Keyframe({1732.0000, 51.1007}, {1718.6666, 50.0627}, {1748.0000, 52.3463}),
        Keyframe({1780.0000, 53.5444}, {1764.0000, 53.5444}, {1797.0000, 53.5444}),
        Keyframe({1831.0000, 46.6849}, {1814.0000, 46.6849}, {1847.0000, 46.6849}),
        Keyframe({1879.0000, 58.8137}, {1863.0000, 53.2307}, {1896.6666, 64.9783}),
        Keyframe({1932.0000, 69.9692}, {1914.3334, 69.9692}, {1947.3334, 69.9692}),
        Keyframe({1978.0000, 52.5045}, {1962.6666, 52.5045}, {1993.3334, 52.5045}),
	});

	addPositionKeyframes(1, {
        Keyframe({992.0000, -22.8585}, {991.6667, -22.8585}, {992.3333, -22.8585}),
        Keyframe({993.0000, -21.5491}, {992.6667, -22.1892}, {1000.3333, -7.4664}),
        Keyframe({1015.0000, -4.7569}, {1007.6667, -7.4848}, {1025.3334, -0.9130}),
        Keyframe({1046.0000, 17.8645}, {1035.6666, 8.3837}, {1060.6666, 31.3211}),
        Keyframe({1090.0000, 54.9874}, {1075.3334, 45.1484}, {1105.3334, 65.2735}),
        Keyframe({1136.0000, 80.7013}, {1120.6666, 71.2003}, {1151.3334, 90.2023}),
        Keyframe({1182.0000, 115.6492}, {1166.6666, 103.2775}, {1199.0000, 129.3658}),
        Keyframe({1233.0000, 152.9177}, {1216.0000, 142.2177}, {1246.3334, 161.3099}),
        Keyframe({1273.0000, 179.2192}, {1259.6666, 168.3784}, {1288.3334, 191.6861}),
        Keyframe({1319.0000, 222.8720}, {1303.6666, 209.1418}, {1334.0000, 236.3037}),
        Keyframe({1364.0000, 253.7765}, {1349.0000, 246.1701}, {1379.3334, 261.5520}),
        Keyframe({1410.0000, 279.7448}, {1394.6666, 266.9658}, {1419.6666, 287.8011}),
        Keyframe({1439.0000, 308.8052}, {1429.3334, 298.7847}, {1451.6666, 321.9356}),
        Keyframe({1477.0000, 342.2812}, {1464.3334, 333.4124}, {1492.6666, 353.2505}),
        Keyframe({1524.0000, 370.1008}, {1508.3334, 360.2300}, {1536.3334, 377.8715}),
        Keyframe({1561.0000, 398.5829}, {1548.6666, 387.4341}, {1573.3334, 409.7317}),
        Keyframe({1598.0000, 430.9676}, {1585.6666, 422.4667}, {1613.0000, 441.3065}),
        Keyframe({1643.0000, 455.7004}, {1628.0000, 445.3824}, {1659.3334, 466.9357}),
        Keyframe({1692.0000, 498.7514}, {1675.6666, 485.5722}, {1705.3334, 509.5099}),
        Keyframe({1732.0000, 524.5046}, {1718.6666, 516.6317}, {1748.0000, 533.9523}),
        Keyframe({1780.0000, 557.9413}, {1764.0000, 544.4816}, {1797.0000, 572.2422}),
        Keyframe({1831.0000, 603.7846}, {1814.0000, 589.8512}, {1847.0000, 616.8984}),
        Keyframe({1879.0000, 636.1391}, {1863.0000, 626.7563}, {1896.6666, 646.4993}),
        Keyframe({1932.0000, 672.8941}, {1914.3334, 656.2802}, {1947.3334, 687.3137}),
        Keyframe({1978.0000, 706.8806}, {1962.6666, 706.8806}, {1993.3334, 706.8806}),
	});

	addPositionKeyframes(2, {
        Keyframe({992.0000, -0.3103}, {991.6667, -0.3103}, {992.3333, -0.3103}),
        Keyframe({993.0000, -0.3103}, {992.6667, -0.3103}, {1000.3333, -0.3095}),
        Keyframe({1015.0000, 0.5211}, {1007.6667, -0.3103}, {1025.3334, 1.6925}),
        Keyframe({1046.0000, 5.2287}, {1035.6666, 5.2287}, {1060.6666, 5.2287}),
        Keyframe({1090.0000, 2.6982}, {1075.3334, 3.3449}, {1105.3334, 2.0222}),
        Keyframe({1136.0000, 0.7213}, {1120.6666, 2.6982}, {1151.3334, -1.2557}),
        Keyframe({1182.0000, -6.3179}, {1166.6666, -6.3179}, {1199.0000, -6.3179}),
        Keyframe({1233.0000, 4.8330}, {1216.0000, 4.8330}, {1246.3334, 4.8330}),
        Keyframe({1273.0000, 1.7413}, {1259.6666, 1.7744}, {1288.3334, 1.7033}),
        Keyframe({1319.0000, 1.7033}, {1303.6666, 1.7033}, {1334.0000, 1.7033}),
        Keyframe({1364.0000, 0.6765}, {1349.0000, 1.7033}, {1379.3334, -0.3732}),
        Keyframe({1410.0000, -9.5771}, {1394.6666, -5.1790}, {1419.6666, -12.3499}),
        Keyframe({1439.0000, -14.9606}, {1429.3334, -14.9606}, {1451.6666, -14.9606}),
        Keyframe({1477.0000, -2.9828}, {1464.3334, -6.4004}, {1492.6666, 1.2443}),
        Keyframe({1524.0000, 1.2443}, {1508.3334, 1.2443}, {1536.3334, 1.2443}),
        Keyframe({1561.0000, -2.3435}, {1548.6666, 0.2072}, {1573.3334, -4.8942}),
        Keyframe({1598.0000, -8.9585}, {1585.6666, -8.9585}, {1613.0000, -8.9585}),
        Keyframe({1643.0000, -2.2077}, {1628.0000, -5.4859}, {1659.3334, 1.3619}),
        Keyframe({1692.0000, 4.7012}, {1675.6666, 4.7012}, {1705.3334, 4.7012}),
        Keyframe({1732.0000, 1.1972}, {1718.6666, 1.1972}, {1748.0000, 1.1972}),
        Keyframe({1780.0000, 2.9755}, {1764.0000, 2.8521}, {1797.0000, 3.1066}),
        Keyframe({1831.0000, 3.1066}, {1814.0000, 3.1066}, {1847.0000, 3.1066}),
        Keyframe({1879.0000, 3.5461}, {1863.0000, 3.1066}, {1896.6666, 4.0313}),
        Keyframe({1932.0000, 5.4031}, {1914.3334, 5.4031}, {1947.3334, 5.4031}),
        Keyframe({1978.0000, 0.9357}, {1962.6666, 0.9357}, {1993.3334, 0.9357}),
	});

	addRotationKeyframes(0, {
        Keyframe({992.0000, 0.9992}, {991.6667, 0.9992}, {992.3333, 0.9992}),
        Keyframe({993.0000, 0.9983}, {992.6667, 0.9987}, {1000.3333, 0.9877}),
        Keyframe({1015.0000, 0.9626}, {1007.6667, 0.9626}, {1025.3334, 0.9626}),
        Keyframe({1046.0000, 0.9746}, {1035.6666, 0.9746}, {1060.6666, 0.9746}),
        Keyframe({1090.0000, 0.9169}, {1075.3334, 0.9169}, {1105.3334, 0.9169}),
        Keyframe({1136.0000, 0.9268}, {1120.6666, 0.9169}, {1151.3334, 0.9367}),
        Keyframe({1182.0000, 0.9911}, {1166.6666, 0.9911}, {1199.0000, 0.9911}),
        Keyframe({1233.0000, 0.9427}, {1216.0000, 0.9427}, {1246.3334, 0.9427}),
        Keyframe({1273.0000, 0.9853}, {1259.6666, 0.9727}, {1288.3334, 0.9998}),
        Keyframe({1319.0000, 0.9998}, {1303.6666, 0.9998}, {1334.0000, 0.9998}),
        Keyframe({1364.0000, 0.9571}, {1349.0000, 0.9691}, {1379.3334, 0.9449}),
        Keyframe({1410.0000, 0.9449}, {1394.6666, 0.9449}, {1419.6666, 0.9449}),
        Keyframe({1439.0000, 0.9691}, {1429.3334, 0.9691}, {1451.6666, 0.9691}),
        Keyframe({1477.0000, 0.9060}, {1464.3334, 0.9060}, {1492.6666, 0.9060}),
        Keyframe({1524.0000, 0.9728}, {1508.3334, 0.9728}, {1536.3334, 0.9728}),
        Keyframe({1561.0000, 0.9660}, {1548.6666, 0.9660}, {1573.3334, 0.9660}),
        Keyframe({1598.0000, 0.9940}, {1585.6666, 0.9940}, {1613.0000, 0.9940}),
        Keyframe({1643.0000, 0.9723}, {1628.0000, 0.9730}, {1659.3334, 0.9715}),
        Keyframe({1692.0000, 0.9715}, {1675.6666, 0.9715}, {1705.3334, 0.9715}),
        Keyframe({1732.0000, 0.9974}, {1718.6666, 0.9974}, {1748.0000, 0.9974}),
        Keyframe({1780.0000, 0.9959}, {1764.0000, 0.9974}, {1797.0000, 0.9942}),
        Keyframe({1831.0000, 0.9711}, {1814.0000, 0.9811}, {1847.0000, 0.9617}),
        Keyframe({1879.0000, 0.9550}, {1863.0000, 0.9550}, {1896.6666, 0.9550}),
        Keyframe({1932.0000, 0.9748}, {1914.3334, 0.9748}, {1947.3334, 0.9748}),
        Keyframe({1978.0000, 0.9410}, {1962.6666, 0.9410}, {1993.3334, 0.9410}),
	});

	addRotationKeyframes(1, {
        Keyframe({992.0000, 0.0002}, {991.6667, 0.0002}, {992.3333, 0.0002}),
        Keyframe({993.0000, 0.0002}, {992.6667, 0.0002}, {1000.3333, 0.0018}),
        Keyframe({1015.0000, 0.1432}, {1007.6667, 0.1432}, {1025.3334, 0.1432}),
        Keyframe({1046.0000, 0.0149}, {1035.6666, 0.0167}, {1060.6666, 0.0123}),
        Keyframe({1090.0000, 0.0123}, {1075.3334, 0.0149}, {1105.3334, 0.0096}),
        Keyframe({1136.0000, -0.1394}, {1120.6666, -0.1394}, {1151.3334, -0.1394}),
        Keyframe({1182.0000, 0.0490}, {1166.6666, 0.0490}, {1199.0000, 0.0490}),
        Keyframe({1233.0000, 0.0097}, {1216.0000, 0.0253}, {1246.3334, -0.0026}),
        Keyframe({1273.0000, -0.0098}, {1259.6666, -0.0098}, {1288.3334, -0.0098}),
        Keyframe({1319.0000, 0.0000}, {1303.6666, 0.0000}, {1334.0000, 0.0000}),
        Keyframe({1364.0000, -0.0494}, {1349.0000, 0.0000}, {1379.3334, -0.0998}),
        Keyframe({1410.0000, -0.2076}, {1394.6666, -0.2076}, {1419.6666, -0.2076}),
        Keyframe({1439.0000, 0.0500}, {1429.3334, -0.0555}, {1451.6666, 0.1883}),
        Keyframe({1477.0000, 0.2466}, {1464.3334, 0.2466}, {1492.6666, 0.2466}),
        Keyframe({1524.0000, 0.0255}, {1508.3334, 0.1383}, {1536.3334, -0.0633}),
        Keyframe({1561.0000, -0.1549}, {1548.6666, -0.1549}, {1573.3334, -0.1549}),
        Keyframe({1598.0000, -0.0346}, {1585.6666, -0.1109}, {1613.0000, 0.0582}),
        Keyframe({1643.0000, 0.1989}, {1628.0000, 0.1989}, {1659.3334, 0.1989}),
        Keyframe({1692.0000, 0.0256}, {1675.6666, 0.0550}, {1705.3334, 0.0016}),
        Keyframe({1732.0000, 0.0016}, {1718.6666, 0.0016}, {1748.0000, 0.0016}),
        Keyframe({1780.0000, 0.0030}, {1764.0000, 0.0030}, {1797.0000, 0.0030}),
        Keyframe({1831.0000, 0.0000}, {1814.0000, 0.0014}, {1847.0000, -0.0013}),
        Keyframe({1879.0000, -0.0023}, {1863.0000, -0.0023}, {1896.6666, -0.0023}),
        Keyframe({1932.0000, 0.0254}, {1914.3334, 0.0254}, {1947.3334, 0.0254}),
        Keyframe({1978.0000, -0.0752}, {1962.6666, -0.0752}, {1993.3334, -0.0752}),
	});

	addRotationKeyframes(2, {
        Keyframe({992.0000, -0.0032}, {991.6667, -0.0032}, {992.3333, -0.0032}),
        Keyframe({993.0000, -0.0046}, {992.6667, -0.0046}, {1000.3333, -0.0046}),
        Keyframe({1015.0000, 0.2213}, {1007.6667, 0.2213}, {1025.3334, 0.2213}),
        Keyframe({1046.0000, -0.0889}, {1035.6666, 0.0442}, {1060.6666, -0.2779}),
        Keyframe({1090.0000, -0.3785}, {1075.3334, -0.3785}, {1105.3334, -0.3785}),
        Keyframe({1136.0000, 0.3474}, {1120.6666, 0.3474}, {1151.3334, 0.3474}),
        Keyframe({1182.0000, -0.1182}, {1166.6666, -0.1182}, {1199.0000, -0.1182}),
        Keyframe({1233.0000, 0.2955}, {1216.0000, 0.2955}, {1246.3334, 0.2955}),
        Keyframe({1273.0000, -0.1594}, {1259.6666, -0.1594}, {1288.3334, -0.1594}),
        Keyframe({1319.0000, 0.0000}, {1303.6666, -0.1075}, {1334.0000, 0.1051}),
        Keyframe({1364.0000, 0.2633}, {1349.0000, 0.2633}, {1379.3334, 0.2633}),
        Keyframe({1410.0000, -0.2366}, {1394.6666, -0.2366}, {1419.6666, -0.2366}),
        Keyframe({1439.0000, 0.2295}, {1429.3334, 0.2295}, {1451.6666, 0.2295}),
        Keyframe({1477.0000, -0.3421}, {1464.3334, -0.3421}, {1492.6666, -0.3421}),
        Keyframe({1524.0000, 0.2303}, {1508.3334, 0.2303}, {1536.3334, 0.2303}),
        Keyframe({1561.0000, -0.2042}, {1548.6666, -0.2042}, {1573.3334, -0.2042}),
        Keyframe({1598.0000, 0.1020}, {1585.6666, 0.1020}, {1613.0000, 0.1020}),
        Keyframe({1643.0000, -0.1214}, {1628.0000, -0.1214}, {1659.3334, -0.1214}),
        Keyframe({1692.0000, 0.2339}, {1675.6666, 0.2339}, {1705.3334, 0.2339}),
        Keyframe({1732.0000, 0.0001}, {1718.6666, 0.0695}, {1748.0000, -0.0833}),
        Keyframe({1780.0000, -0.0833}, {1764.0000, -0.0833}, {1797.0000, -0.0833}),
        Keyframe({1831.0000, 0.2386}, {1814.0000, 0.2386}, {1847.0000, 0.2386}),
        Keyframe({1879.0000, -0.0974}, {1863.0000, 0.0094}, {1896.6666, -0.2154}),
        Keyframe({1932.0000, -0.2154}, {1914.3334, -0.2154}, {1947.3334, -0.2154}),
        Keyframe({1978.0000, -0.0332}, {1962.6666, -0.0332}, {1993.3334, -0.0332}),
	});

	addRotationKeyframes(3, {
        Keyframe({992.0000, 0.0403}, {991.6667, 0.0403}, {992.3333, 0.0403}),
        Keyframe({993.0000, 0.0589}, {992.6667, 0.0589}, {1000.3333, 0.0589}),
        Keyframe({1015.0000, -0.0632}, {1007.6667, -0.0066}, {1025.3334, -0.1429}),
        Keyframe({1046.0000, -0.2051}, {1035.6666, -0.2051}, {1060.6666, -0.2051}),
        Keyframe({1090.0000, 0.1265}, {1075.3334, 0.1265}, {1105.3334, 0.1265}),
        Keyframe({1136.0000, -0.0308}, {1120.6666, -0.0308}, {1151.3334, -0.0308}),
        Keyframe({1182.0000, 0.0362}, {1166.6666, 0.0362}, {1199.0000, 0.0362}),
        Keyframe({1233.0000, -0.1545}, {1216.0000, -0.1545}, {1246.3334, -0.1545}),
        Keyframe({1273.0000, -0.0603}, {1259.6666, -0.1015}, {1288.3334, -0.0129}),
        Keyframe({1319.0000, 0.0188}, {1303.6666, 0.0188}, {1334.0000, 0.0188}),
        Keyframe({1364.0000, -0.1100}, {1349.0000, -0.1100}, {1379.3334, -0.1100}),
        Keyframe({1410.0000, -0.0901}, {1394.6666, -0.0978}, {1419.6666, -0.0853}),
        Keyframe({1439.0000, -0.0750}, {1429.3334, -0.0823}, {1451.6666, -0.0654}),
        Keyframe({1477.0000, -0.0358}, {1464.3334, -0.0485}, {1492.6666, -0.0202}),
        Keyframe({1524.0000, 0.0048}, {1508.3334, -0.0111}, {1536.3334, 0.0174}),
        Keyframe({1561.0000, 0.0342}, {1548.6666, 0.0342}, {1573.3334, 0.0342}),
        Keyframe({1598.0000, -0.0204}, {1585.6666, -0.0204}, {1613.0000, -0.0204}),
        Keyframe({1643.0000, 0.0182}, {1628.0000, 0.0182}, {1659.3334, 0.0182}),
        Keyframe({1692.0000, -0.0279}, {1675.6666, -0.0028}, {1705.3334, -0.0483}),
        Keyframe({1732.0000, -0.0714}, {1718.6666, -0.0714}, {1748.0000, -0.0714}),
        Keyframe({1780.0000, 0.0357}, {1764.0000, 0.0357}, {1797.0000, 0.0357}),
        Keyframe({1831.0000, 0.0000}, {1814.0000, 0.0357}, {1847.0000, -0.0336}),
        Keyframe({1879.0000, -0.2802}, {1863.0000, -0.2802}, {1896.6666, -0.2802}),
        Keyframe({1932.0000, 0.0517}, {1914.3334, -0.1108}, {1947.3334, 0.1927}),
        Keyframe({1978.0000, 0.3283}, {1962.6666, 0.3283}, {1993.3334, 0.3283}),
	});
}
